---
- name: Test NetBox API Connection
  hosts: all
  gather_facts: no
  tasks:
    - name: Get NetBox Status from API (Or checking if the status is 200 ok)
      ansible.builtin.uri:
        # Use the exact URL and Port from your curl command
        url: "http://10.201.6.37:8000/api/status/"
        method: GET
        status_code: 200
        validate_certs: false
        headers:
          # Use 'Bearer' instead of 'Token'
          Authorization: "Bearer nbt_iPhxAmW1x8rK.zA2u8f3d1c6STZAtMubFhGe39aOnAsIkcKIlDZ4W"
          Content-Type: "application/json"
          Accept: "application/json; indent=4"
      register: netbox_status

    - name: Display NetBox Information
      debug:
        msg:
          - "Successfully connected to NetBox!"
          - "NetBox Version: {{ netbox_status.json['netbox-version'] }}"
